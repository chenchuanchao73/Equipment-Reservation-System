{"ast":null,"code":"import { getDbTables, getDbTableColumns, getDbTableRows } from '@/api/dbAdmin';\nimport { mapState } from 'vuex';\nexport default {\n  name: 'DatabaseViewer',\n  data() {\n    return {\n      tables: [],\n      selectedTable: '',\n      columns: [],\n      rows: [],\n      total: 0,\n      page: 1,\n      pageSize: 20,\n      loading: false,\n      inited: false,\n      // 表字段注释对照表\n      fieldComments: {\n        // 通用字段\n        id: '唯一标识符，数据表主键',\n        created_at: '记录创建时间',\n        updated_at: '记录最后更新时间',\n        // admin表\n        username: '管理员登录用户名',\n        password_hash: '加密后的密码哈希值',\n        name: '管理员姓名/显示名称',\n        role: '管理员角色权限，如superadmin、admin等',\n        is_active: '账号是否激活状态，1表示激活，0表示禁用',\n        // equipment表\n        equipment_id: '设备ID，外键关联设备表',\n        equipment_name: '设备名称',\n        equipment_code: '设备编码',\n        category_id: '设备分类ID，外键关联设备分类表',\n        image_url: '设备图片URL',\n        status: '设备或预约状态，如available、in_use、maintenance等',\n        description: '详细描述',\n        location: '设备存放位置',\n        // equipment_category表\n        category_name: '设备分类名称',\n        // reservation表\n        reservation_code: '预约编码，用于查询预约信息',\n        user_name: '预约用户姓名',\n        user_department: '预约用户所属部门',\n        user_contact: '预约用户联系方式',\n        user_email: '预约用户电子邮箱',\n        start_datetime: '预约开始时间',\n        end_datetime: '预约结束时间',\n        purpose: '预约用途说明',\n        recurring_reservation_id: '关联的周期性预约ID',\n        is_exception: '是否为特例预约，1表示是，0表示否',\n        reservation_number: '预约编号',\n        // recurring_reservation表\n        repeat_type: '重复类型，如daily、weekly、monthly等',\n        repeat_interval: '重复间隔',\n        repeat_end_date: '重复结束日期',\n        repeat_days: '重复的星期几(针对每周重复)',\n        // email_logs表\n        email_to: '邮件接收者',\n        email_subject: '邮件主题',\n        email_body: '邮件正文内容',\n        content_html: 'HTML格式的邮件内容',\n        sent_at: '邮件发送时间',\n        // email_settings表\n        smtp_server: 'SMTP服务器地址',\n        smtp_port: 'SMTP服务器端口',\n        smtp_username: 'SMTP服务器用户名',\n        smtp_password: 'SMTP服务器密码',\n        sender_email: '发件人邮箱',\n        sender_name: '发件人显示名称',\n        // email_templates表\n        template_name: '邮件模板名称',\n        template_subject: '邮件模板主题',\n        template_content: '邮件模板内容',\n        template_code: '邮件模板代码',\n        // system_settings表\n        key: '系统设置键名',\n        value: '系统设置值'\n      }\n    };\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user\n    }),\n    isSuperAdmin() {\n      return this.user && this.user.role === 'superadmin';\n    },\n    // 判断是否为小表格（列少的表格）\n    isSmallTable() {\n      const smallTables = ['admin', 'equipment_category', 'system_settings'];\n      return !smallTables.includes(this.selectedTable);\n    }\n  },\n  created() {\n    console.log(\"DatabaseViewer 组件 created\");\n  },\n  mounted() {\n    console.log(\"DatabaseViewer 组件 mounted, 调用 initIfNeeded\");\n    this.initIfNeeded();\n  },\n  methods: {\n    async initIfNeeded() {\n      console.log(\"initIfNeeded 被调用，inited=\", this.inited, \"isSuperAdmin=\", this.isSuperAdmin);\n      if (!this.inited && this.isSuperAdmin) {\n        this.inited = true;\n        await this.fetchTables();\n      }\n    },\n    async fetchTables() {\n      console.log(\"开始获取数据库表名...\");\n      try {\n        console.log(\"调用 getDbTables()\");\n        const res = await getDbTables();\n        console.log(\"获取表名结果:\", res);\n        this.tables = res.data.tables || [];\n        if (this.tables.length > 0) {\n          this.handleTableSelect(this.tables[0]);\n        }\n      } catch (e) {\n        console.error(\"获取表名失败:\", e);\n        this.$message.error('获取表名失败: ' + (e.message || e));\n      }\n    },\n    async handleTableSelect(table) {\n      this.selectedTable = table;\n      this.page = 1;\n      await this.fetchTableColumns();\n      await this.fetchTableRows();\n    },\n    async fetchTableColumns() {\n      try {\n        const res = await getDbTableColumns(this.selectedTable);\n        // 兼容不同数据库字段名\n        this.columns = (res.data.columns || []).map(col => ({\n          name: col.name || col.column_name,\n          type: col.type || col.type_name,\n          nullable: col.nullable !== undefined ? col.nullable : col.nullable_,\n          default: col.default,\n          comment: col.comment || ''\n        }));\n      } catch (e) {\n        this.columns = [];\n        this.$message.error('获取字段信息失败');\n      }\n    },\n    async fetchTableRows() {\n      this.loading = true;\n      try {\n        const res = await getDbTableRows(this.selectedTable, {\n          skip: (this.page - 1) * this.pageSize,\n          limit: this.pageSize\n        });\n        this.rows = res.data.rows || [];\n\n        // 使用后端返回的总行数\n        if (res.data.total !== undefined) {\n          this.total = res.data.total;\n        } else {\n          // 兼容旧版API，如果后端没有返回总行数，则使用简单估算\n          if (this.rows.length < this.pageSize) {\n            // 当前页不满，可能是最后一页\n            this.total = (this.page - 1) * this.pageSize + this.rows.length;\n          } else {\n            // 当前页是满的，假设至少还有一页\n            this.total = this.page * this.pageSize + this.pageSize;\n          }\n        }\n      } catch (e) {\n        this.rows = [];\n        this.$message.error('获取表数据失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    handlePageChange(page) {\n      this.page = page;\n      this.fetchTableRows();\n    },\n    handleSizeChange(size) {\n      this.pageSize = size;\n      this.page = 1;\n      this.fetchTableRows();\n    },\n    refreshTable() {\n      this.fetchTableColumns();\n      this.fetchTableRows();\n    },\n    // 获取字段注释\n    getFieldComment(fieldName) {\n      // 先查表+字段名的精确匹配\n      const fullKey = `${this.selectedTable}.${fieldName}`;\n      if (this.fieldComments[fullKey]) {\n        return this.fieldComments[fullKey];\n      }\n\n      // 再查通用字段名匹配\n      if (this.fieldComments[fieldName]) {\n        return this.fieldComments[fieldName];\n      }\n\n      // 对于特殊字段进行单独处理\n      const lowerFieldName = fieldName.toLowerCase();\n      if (lowerFieldName.includes('id') && lowerFieldName !== 'id') {\n        return '关联的ID，外键引用';\n      }\n      if (lowerFieldName.includes('date') || lowerFieldName.includes('time')) {\n        return '日期/时间字段';\n      }\n      if (lowerFieldName.includes('name')) {\n        return '名称';\n      }\n      if (lowerFieldName.includes('description') || lowerFieldName.includes('desc')) {\n        return '描述信息';\n      }\n      if (lowerFieldName.includes('status')) {\n        return '状态标志';\n      }\n      if (lowerFieldName.includes('email')) {\n        return '电子邮箱地址';\n      }\n      if (lowerFieldName.includes('code')) {\n        return '编码标识';\n      }\n      if (lowerFieldName.includes('is_') || lowerFieldName.endsWith('_flag')) {\n        return '布尔标志，1表示是，0表示否';\n      }\n\n      // 没有预定义的注释，则显示默认值\n      const column = this.columns.find(col => col.name === fieldName);\n      if (column && column.default) {\n        return `默认值: ${column.default}`;\n      }\n      return '无注释';\n    },\n    // 获取最小列宽（用于自适应模式的表格）\n    getColumnMinWidth(columnName) {\n      const lowerColumnName = columnName.toLowerCase();\n\n      // 针对特定表格中的特定列进行特殊处理\n      if (this.selectedTable === 'admin') {\n        if (lowerColumnName === 'id') return 80;\n        if (lowerColumnName === 'username') return 150;\n        if (lowerColumnName === 'password_hash') return 300;\n        if (lowerColumnName === 'name') return 150;\n        if (lowerColumnName === 'role') return 120;\n        if (lowerColumnName === 'is_active') return 100;\n        if (lowerColumnName === 'created_at') return 180;\n        return 150;\n      }\n      if (this.selectedTable === 'equipment_category') {\n        if (lowerColumnName === 'id') return 80;\n        if (lowerColumnName === 'name') return 200;\n        if (lowerColumnName === 'description') return 300;\n        if (lowerColumnName === 'created_at') return 180;\n        return 200;\n      }\n      if (this.selectedTable === 'system_settings') {\n        if (lowerColumnName === 'id') return 80;\n        if (lowerColumnName === 'key') return 200;\n        if (lowerColumnName === 'value') return 400;\n        if (lowerColumnName === 'description') return 300;\n        return 200;\n      }\n\n      // 默认最小列宽\n      if (lowerColumnName.includes('content_html') || lowerColumnName.includes('html')) {\n        return 300;\n      } else if (lowerColumnName === 'id') {\n        return 80;\n      } else if (lowerColumnName.includes('date') || lowerColumnName.includes('time')) {\n        return 160;\n      } else {\n        return 120;\n      }\n    },\n    // 标准列宽（用于固定模式的表格）\n    getColumnWidth(columnName) {\n      const lowerColumnName = columnName.toLowerCase();\n\n      // 特殊表格特殊处理\n      if (this.selectedTable === 'email_logs' && lowerColumnName === 'content_html') {\n        return 500;\n      }\n\n      // 根据列名类型分配宽度\n      if (lowerColumnName.includes('content_html') || lowerColumnName.includes('html') || lowerColumnName.includes('content')) {\n        return 300;\n      } else if (lowerColumnName === 'id') {\n        return 80;\n      } else if (lowerColumnName.includes('date') || lowerColumnName.includes('time')) {\n        return 160;\n      } else if (lowerColumnName.includes('name')) {\n        return 120;\n      } else if (lowerColumnName.includes('code') || lowerColumnName.includes('number')) {\n        return 140;\n      } else if (lowerColumnName.includes('title')) {\n        return 120;\n      } else if (lowerColumnName.includes('email')) {\n        return 180;\n      } else if (lowerColumnName.includes('description') || lowerColumnName.includes('comment')) {\n        return 200;\n      } else if (lowerColumnName.includes('status')) {\n        return 120;\n      } else if (lowerColumnName.includes('password') || lowerColumnName.includes('hash')) {\n        return 250;\n      } else {\n        return 120;\n      }\n    },\n    // 格式化单元格内容\n    formatCell(row, column, cellValue) {\n      if (cellValue === null || cellValue === undefined) {\n        return '';\n      }\n\n      // 如果是HTML内容，只显示部分文本并添加提示\n      if (column.property.toLowerCase().includes('content_html') || column.property.toLowerCase().includes('html')) {\n        if (typeof cellValue === 'string' && cellValue.length > 100) {\n          return cellValue.substring(0, 100) + '...';\n        }\n      }\n\n      // 对日期时间格式化\n      if ((column.property.toLowerCase().includes('date') || column.property.toLowerCase().includes('time')) && !isNaN(Date.parse(cellValue))) {\n        try {\n          return new Date(cellValue).toLocaleString();\n        } catch (e) {\n          return cellValue;\n        }\n      }\n      return cellValue;\n    }\n  }\n};","map":{"version":3,"names":["getDbTables","getDbTableColumns","getDbTableRows","mapState","name","data","tables","selectedTable","columns","rows","total","page","pageSize","loading","inited","fieldComments","id","created_at","updated_at","username","password_hash","role","is_active","equipment_id","equipment_name","equipment_code","category_id","image_url","status","description","location","category_name","reservation_code","user_name","user_department","user_contact","user_email","start_datetime","end_datetime","purpose","recurring_reservation_id","is_exception","reservation_number","repeat_type","repeat_interval","repeat_end_date","repeat_days","email_to","email_subject","email_body","content_html","sent_at","smtp_server","smtp_port","smtp_username","smtp_password","sender_email","sender_name","template_name","template_subject","template_content","template_code","key","value","computed","user","state","isSuperAdmin","isSmallTable","smallTables","includes","created","console","log","mounted","initIfNeeded","methods","fetchTables","res","length","handleTableSelect","e","error","$message","message","table","fetchTableColumns","fetchTableRows","map","col","column_name","type","type_name","nullable","undefined","nullable_","default","comment","skip","limit","handlePageChange","handleSizeChange","size","refreshTable","getFieldComment","fieldName","fullKey","lowerFieldName","toLowerCase","endsWith","column","find","getColumnMinWidth","columnName","lowerColumnName","getColumnWidth","formatCell","row","cellValue","property","substring","isNaN","Date","parse","toLocaleString"],"sources":["src/views/admin/DatabaseViewer.vue"],"sourcesContent":["<template>\r\n  <div class=\"db-viewer\" v-if=\"isSuperAdmin\">\r\n    <el-row>\r\n      <el-col :span=\"4\" class=\"db-tables-list\">\r\n        <el-card shadow=\"never\" style=\"height: 100%\">\r\n          <div slot=\"header\"><b>数据库表</b></div>\r\n          <el-scrollbar style=\"height: 70vh\">\r\n            <el-menu :default-active=\"selectedTable\" @select=\"handleTableSelect\">\r\n              <el-menu-item v-for=\"table in tables\" :key=\"table\" :index=\"table\">\r\n                {{ table }}\r\n              </el-menu-item>\r\n            </el-menu>\r\n          </el-scrollbar>\r\n        </el-card>\r\n      </el-col>\r\n      <el-col :span=\"20\" class=\"db-table-content\">\r\n        <el-card shadow=\"never\" style=\"min-height: 70vh\">\r\n          <div slot=\"header\" class=\"db-table-header\">\r\n            <span v-if=\"selectedTable\"><b>{{ selectedTable }}</b>（共 {{ total }} 条）</span>\r\n            <el-button v-if=\"selectedTable\" size=\"mini\" icon=\"el-icon-refresh\" @click=\"refreshTable\" style=\"float: right;\">刷新</el-button>\r\n          </div>\r\n          <div v-if=\"selectedTable\" class=\"table-container\">\r\n            <div class=\"table-wrapper\">\r\n              <el-table \r\n                :data=\"rows\" \r\n                border \r\n                size=\"small\" \r\n                :table-layout=\"isSmallTable ? 'fixed' : 'auto'\"\r\n                style=\"width: 100%\" \r\n                :height=\"540\"\r\n                class=\"custom-table\"\r\n                highlight-current-row\r\n              >\r\n                <el-table-column\r\n                  v-for=\"col in columns\" \r\n                  :key=\"col.name\" \r\n                  :prop=\"col.name\" \r\n                  :label=\"col.name\" \r\n                  :width=\"isSmallTable ? getColumnWidth(col.name) : ''\"\r\n                  :min-width=\"isSmallTable ? '' : getColumnMinWidth(col.name)\"\r\n                  :formatter=\"formatCell\"\r\n                  show-overflow-tooltip\r\n                  header-align=\"center\"\r\n                  align=\"center\"\r\n                />\r\n              </el-table>\r\n            </div>\r\n            <el-pagination\r\n              v-if=\"total > 0\"\r\n              background\r\n              layout=\"total, sizes, prev, pager, next, jumper\"\r\n              :current-page.sync=\"page\"\r\n              :page-size=\"pageSize\"\r\n              :page-sizes=\"[10, 20, 50, 100]\"\r\n              :pager-count=\"7\"\r\n              :total=\"total\"\r\n              @current-change=\"handlePageChange\"\r\n              @size-change=\"handleSizeChange\"\r\n              style=\"margin-top: 16px; text-align: right;\"\r\n            />\r\n            <div class=\"db-table-columns-info\" style=\"margin-top: 16px;\">\r\n              <b>字段信息：</b>\r\n              <el-table :data=\"columns\" border size=\"mini\" table-layout=\"fixed\" style=\"width: 100%; margin-top: 8px;\">\r\n                <el-table-column prop=\"name\" label=\"字段名\" width=\"150\" />\r\n                <el-table-column prop=\"type\" label=\"类型\" width=\"150\" />\r\n                <el-table-column prop=\"nullable\" label=\"可空\" width=\"80\">\r\n                  <template slot-scope=\"scope\">\r\n                    <el-tag :type=\"scope.row.nullable ? 'info' : 'success'\">{{ scope.row.nullable ? '是' : '否' }}</el-tag>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"comment\" label=\"注释\" min-width=\"250\">\r\n                  <template slot-scope=\"scope\">\r\n                    {{ getFieldComment(scope.row.name) }}\r\n                  </template>\r\n                </el-table-column>\r\n              </el-table>\r\n            </div>\r\n          </div>\r\n          <div v-else style=\"text-align:center; color:#888; padding: 60px 0;\">请选择左侧表名</div>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n  <div v-else style=\"text-align:center; color:#888; padding: 60px 0;\">无权限，仅超级管理员可访问</div>\r\n</template>\r\n\r\n<script>\r\nimport { getDbTables, getDbTableColumns, getDbTableRows } from '@/api/dbAdmin'\r\nimport { mapState } from 'vuex'\r\n\r\nexport default {\r\n  name: 'DatabaseViewer',\r\n  data() {\r\n    return {\r\n      tables: [],\r\n      selectedTable: '',\r\n      columns: [],\r\n      rows: [],\r\n      total: 0,\r\n      page: 1,\r\n      pageSize: 20,\r\n      loading: false,\r\n      inited: false,\r\n      // 表字段注释对照表\r\n      fieldComments: {\r\n        // 通用字段\r\n        id: '唯一标识符，数据表主键',\r\n        created_at: '记录创建时间',\r\n        updated_at: '记录最后更新时间',\r\n        \r\n        // admin表\r\n        username: '管理员登录用户名',\r\n        password_hash: '加密后的密码哈希值',\r\n        name: '管理员姓名/显示名称',\r\n        role: '管理员角色权限，如superadmin、admin等',\r\n        is_active: '账号是否激活状态，1表示激活，0表示禁用',\r\n        \r\n        // equipment表\r\n        equipment_id: '设备ID，外键关联设备表',\r\n        equipment_name: '设备名称',\r\n        equipment_code: '设备编码',\r\n        category_id: '设备分类ID，外键关联设备分类表',\r\n        image_url: '设备图片URL',\r\n        status: '设备或预约状态，如available、in_use、maintenance等',\r\n        description: '详细描述',\r\n        location: '设备存放位置',\r\n        \r\n        // equipment_category表\r\n        category_name: '设备分类名称',\r\n        \r\n        // reservation表\r\n        reservation_code: '预约编码，用于查询预约信息',\r\n        user_name: '预约用户姓名',\r\n        user_department: '预约用户所属部门',\r\n        user_contact: '预约用户联系方式',\r\n        user_email: '预约用户电子邮箱',\r\n        start_datetime: '预约开始时间',\r\n        end_datetime: '预约结束时间',\r\n        purpose: '预约用途说明',\r\n        recurring_reservation_id: '关联的周期性预约ID',\r\n        is_exception: '是否为特例预约，1表示是，0表示否',\r\n        reservation_number: '预约编号',\r\n        \r\n        // recurring_reservation表\r\n        repeat_type: '重复类型，如daily、weekly、monthly等',\r\n        repeat_interval: '重复间隔',\r\n        repeat_end_date: '重复结束日期',\r\n        repeat_days: '重复的星期几(针对每周重复)',\r\n        \r\n        // email_logs表\r\n        email_to: '邮件接收者',\r\n        email_subject: '邮件主题',\r\n        email_body: '邮件正文内容',\r\n        content_html: 'HTML格式的邮件内容',\r\n        sent_at: '邮件发送时间',\r\n        \r\n        // email_settings表\r\n        smtp_server: 'SMTP服务器地址',\r\n        smtp_port: 'SMTP服务器端口',\r\n        smtp_username: 'SMTP服务器用户名',\r\n        smtp_password: 'SMTP服务器密码',\r\n        sender_email: '发件人邮箱',\r\n        sender_name: '发件人显示名称',\r\n        \r\n        // email_templates表\r\n        template_name: '邮件模板名称',\r\n        template_subject: '邮件模板主题',\r\n        template_content: '邮件模板内容',\r\n        template_code: '邮件模板代码',\r\n        \r\n        // system_settings表\r\n        key: '系统设置键名',\r\n        value: '系统设置值',\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      user: state => state.user,\r\n    }),\r\n    isSuperAdmin() {\r\n      return this.user && this.user.role === 'superadmin'\r\n    },\r\n    // 判断是否为小表格（列少的表格）\r\n    isSmallTable() {\r\n      const smallTables = ['admin', 'equipment_category', 'system_settings'];\r\n      return !smallTables.includes(this.selectedTable);\r\n    }\r\n  },\r\n  created() {\r\n    console.log(\"DatabaseViewer 组件 created\")\r\n  },\r\n  mounted() {\r\n    console.log(\"DatabaseViewer 组件 mounted, 调用 initIfNeeded\")\r\n    this.initIfNeeded()\r\n  },\r\n  methods: {\r\n    async initIfNeeded() {\r\n      console.log(\"initIfNeeded 被调用，inited=\", this.inited, \"isSuperAdmin=\", this.isSuperAdmin)\r\n      if (!this.inited && this.isSuperAdmin) {\r\n        this.inited = true\r\n        await this.fetchTables()\r\n      }\r\n    },\r\n    async fetchTables() {\r\n      console.log(\"开始获取数据库表名...\")\r\n      try {\r\n        console.log(\"调用 getDbTables()\")\r\n        const res = await getDbTables()\r\n        console.log(\"获取表名结果:\", res)\r\n        this.tables = res.data.tables || []\r\n        if (this.tables.length > 0) {\r\n          this.handleTableSelect(this.tables[0])\r\n        }\r\n      } catch (e) {\r\n        console.error(\"获取表名失败:\", e)\r\n        this.$message.error('获取表名失败: ' + (e.message || e))\r\n      }\r\n    },\r\n    async handleTableSelect(table) {\r\n      this.selectedTable = table\r\n      this.page = 1\r\n      await this.fetchTableColumns()\r\n      await this.fetchTableRows()\r\n    },\r\n    async fetchTableColumns() {\r\n      try {\r\n        const res = await getDbTableColumns(this.selectedTable)\r\n        // 兼容不同数据库字段名\r\n        this.columns = (res.data.columns || []).map(col => ({\r\n          name: col.name || col.column_name,\r\n          type: col.type || col.type_name,\r\n          nullable: col.nullable !== undefined ? col.nullable : col.nullable_,\r\n          default: col.default,\r\n          comment: col.comment || ''\r\n        }))\r\n      } catch (e) {\r\n        this.columns = []\r\n        this.$message.error('获取字段信息失败')\r\n      }\r\n    },\r\n    async fetchTableRows() {\r\n      this.loading = true\r\n      try {\r\n        const res = await getDbTableRows(this.selectedTable, {\r\n          skip: (this.page - 1) * this.pageSize,\r\n          limit: this.pageSize,\r\n        })\r\n        this.rows = res.data.rows || []\r\n        \r\n        // 使用后端返回的总行数\r\n        if (res.data.total !== undefined) {\r\n          this.total = res.data.total;\r\n        } else {\r\n          // 兼容旧版API，如果后端没有返回总行数，则使用简单估算\r\n          if (this.rows.length < this.pageSize) {\r\n            // 当前页不满，可能是最后一页\r\n            this.total = (this.page - 1) * this.pageSize + this.rows.length;\r\n          } else {\r\n            // 当前页是满的，假设至少还有一页\r\n            this.total = this.page * this.pageSize + this.pageSize;\r\n          }\r\n        }\r\n      } catch (e) {\r\n        this.rows = []\r\n        this.$message.error('获取表数据失败')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    handlePageChange(page) {\r\n      this.page = page\r\n      this.fetchTableRows()\r\n    },\r\n    handleSizeChange(size) {\r\n      this.pageSize = size\r\n      this.page = 1\r\n      this.fetchTableRows()\r\n    },\r\n    refreshTable() {\r\n      this.fetchTableColumns()\r\n      this.fetchTableRows()\r\n    },\r\n    // 获取字段注释\r\n    getFieldComment(fieldName) {\r\n      // 先查表+字段名的精确匹配\r\n      const fullKey = `${this.selectedTable}.${fieldName}`;\r\n      if (this.fieldComments[fullKey]) {\r\n        return this.fieldComments[fullKey];\r\n      }\r\n      \r\n      // 再查通用字段名匹配\r\n      if (this.fieldComments[fieldName]) {\r\n        return this.fieldComments[fieldName];\r\n      }\r\n      \r\n      // 对于特殊字段进行单独处理\r\n      const lowerFieldName = fieldName.toLowerCase();\r\n      \r\n      if (lowerFieldName.includes('id') && lowerFieldName !== 'id') {\r\n        return '关联的ID，外键引用';\r\n      }\r\n      \r\n      if (lowerFieldName.includes('date') || lowerFieldName.includes('time')) {\r\n        return '日期/时间字段';\r\n      }\r\n      \r\n      if (lowerFieldName.includes('name')) {\r\n        return '名称';\r\n      }\r\n      \r\n      if (lowerFieldName.includes('description') || lowerFieldName.includes('desc')) {\r\n        return '描述信息';\r\n      }\r\n      \r\n      if (lowerFieldName.includes('status')) {\r\n        return '状态标志';\r\n      }\r\n      \r\n      if (lowerFieldName.includes('email')) {\r\n        return '电子邮箱地址';\r\n      }\r\n      \r\n      if (lowerFieldName.includes('code')) {\r\n        return '编码标识';\r\n      }\r\n      \r\n      if (lowerFieldName.includes('is_') || lowerFieldName.endsWith('_flag')) {\r\n        return '布尔标志，1表示是，0表示否';\r\n      }\r\n      \r\n      // 没有预定义的注释，则显示默认值\r\n      const column = this.columns.find(col => col.name === fieldName);\r\n      if (column && column.default) {\r\n        return `默认值: ${column.default}`;\r\n      }\r\n      \r\n      return '无注释';\r\n    },\r\n    // 获取最小列宽（用于自适应模式的表格）\r\n    getColumnMinWidth(columnName) {\r\n      const lowerColumnName = columnName.toLowerCase();\r\n      \r\n      // 针对特定表格中的特定列进行特殊处理\r\n      if (this.selectedTable === 'admin') {\r\n        if (lowerColumnName === 'id') return 80;\r\n        if (lowerColumnName === 'username') return 150;\r\n        if (lowerColumnName === 'password_hash') return 300;\r\n        if (lowerColumnName === 'name') return 150;\r\n        if (lowerColumnName === 'role') return 120;\r\n        if (lowerColumnName === 'is_active') return 100;\r\n        if (lowerColumnName === 'created_at') return 180;\r\n        return 150;\r\n      }\r\n      \r\n      if (this.selectedTable === 'equipment_category') {\r\n        if (lowerColumnName === 'id') return 80;\r\n        if (lowerColumnName === 'name') return 200;\r\n        if (lowerColumnName === 'description') return 300;\r\n        if (lowerColumnName === 'created_at') return 180;\r\n        return 200;\r\n      }\r\n      \r\n      if (this.selectedTable === 'system_settings') {\r\n        if (lowerColumnName === 'id') return 80;\r\n        if (lowerColumnName === 'key') return 200;\r\n        if (lowerColumnName === 'value') return 400;\r\n        if (lowerColumnName === 'description') return 300;\r\n        return 200;\r\n      }\r\n      \r\n      // 默认最小列宽\r\n      if (lowerColumnName.includes('content_html') || lowerColumnName.includes('html')) {\r\n        return 300;\r\n      } else if (lowerColumnName === 'id') {\r\n        return 80;\r\n      } else if (lowerColumnName.includes('date') || lowerColumnName.includes('time')) {\r\n        return 160;\r\n      } else {\r\n        return 120;\r\n      }\r\n    },\r\n    \r\n    // 标准列宽（用于固定模式的表格）\r\n    getColumnWidth(columnName) {\r\n      const lowerColumnName = columnName.toLowerCase();\r\n      \r\n      // 特殊表格特殊处理\r\n      if (this.selectedTable === 'email_logs' && lowerColumnName === 'content_html') {\r\n        return 500;\r\n      }\r\n      \r\n      // 根据列名类型分配宽度\r\n      if (lowerColumnName.includes('content_html') || lowerColumnName.includes('html') || lowerColumnName.includes('content')) {\r\n        return 300;\r\n      } else if (lowerColumnName === 'id') {\r\n        return 80;\r\n      } else if (lowerColumnName.includes('date') || lowerColumnName.includes('time')) {\r\n        return 160;\r\n      } else if (lowerColumnName.includes('name')) {\r\n        return 120;\r\n      } else if (lowerColumnName.includes('code') || lowerColumnName.includes('number')) {\r\n        return 140;\r\n      } else if (lowerColumnName.includes('title')) {\r\n        return 120;\r\n      } else if (lowerColumnName.includes('email')) {\r\n        return 180;\r\n      } else if (lowerColumnName.includes('description') || lowerColumnName.includes('comment')) {\r\n        return 200;\r\n      } else if (lowerColumnName.includes('status')) {\r\n        return 120;\r\n      } else if (lowerColumnName.includes('password') || lowerColumnName.includes('hash')) {\r\n        return 250;\r\n      } else {\r\n        return 120;\r\n      }\r\n    },\r\n    \r\n    // 格式化单元格内容\r\n    formatCell(row, column, cellValue) {\r\n      if (cellValue === null || cellValue === undefined) {\r\n        return '';\r\n      }\r\n      \r\n      // 如果是HTML内容，只显示部分文本并添加提示\r\n      if (column.property.toLowerCase().includes('content_html') || column.property.toLowerCase().includes('html')) {\r\n        if (typeof cellValue === 'string' && cellValue.length > 100) {\r\n          return cellValue.substring(0, 100) + '...';\r\n        }\r\n      }\r\n      \r\n      // 对日期时间格式化\r\n      if ((column.property.toLowerCase().includes('date') || column.property.toLowerCase().includes('time')) && \r\n          !isNaN(Date.parse(cellValue))) {\r\n        try {\r\n          return new Date(cellValue).toLocaleString();\r\n        } catch (e) {\r\n          return cellValue;\r\n        }\r\n      }\r\n      \r\n      return cellValue;\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style>\r\n.db-viewer {\r\n  padding: 24px;\r\n}\r\n.db-tables-list {\r\n  border-right: 1px solid #eee;\r\n  min-height: 70vh;\r\n}\r\n.db-table-content {\r\n  padding-left: 24px;\r\n}\r\n.db-table-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n}\r\n.table-container {\r\n  position: relative;\r\n  margin-bottom: 16px;\r\n}\r\n.table-wrapper {\r\n  width: 100%;\r\n  overflow: auto !important;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 4px;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n/* 修改滚动条样式使其更明显 */\r\n::-webkit-scrollbar {\r\n  width: 12px !important;\r\n  height: 12px !important;\r\n  background-color: #f5f7fa !important;\r\n}\r\n::-webkit-scrollbar-thumb {\r\n  background-color: #909399 !important;\r\n  border-radius: 6px !important;\r\n  border: 2px solid #f5f7fa !important;\r\n}\r\n::-webkit-scrollbar-thumb:hover {\r\n  background-color: #606266 !important;\r\n}\r\n::-webkit-scrollbar-corner {\r\n  background-color: #f5f7fa !important;\r\n}\r\n\r\n/* 强制表格显示滚动条 */\r\n.el-table__body-wrapper {\r\n  overflow: auto !important;\r\n}\r\n\r\n/* 表格样式优化 */\r\n.el-table__header th {\r\n  background-color: #f5f7fa !important;\r\n  color: #606266 !important;\r\n  font-weight: bold !important;\r\n  padding: 8px 0 !important;\r\n}\r\n\r\n/* 修复行高问题 */\r\n.el-table__row {\r\n  height: auto !important;\r\n}\r\n\r\n/* 修改tooltip样式 */\r\n.el-tooltip__popper {\r\n  max-width: 400px !important;\r\n  white-space: pre-wrap !important;\r\n  word-break: break-word !important;\r\n}\r\n\r\n/* 改进分页器外观 */\r\n.el-pagination {\r\n  padding: 16px 6px !important;\r\n  background-color: #f9f9f9 !important;\r\n  border-radius: 4px !important;\r\n}\r\n\r\n/* 字段信息表样式 */\r\n.db-table-columns-info .el-table {\r\n  margin-top: 10px !important;\r\n}\r\n.db-table-columns-info .el-table__header th {\r\n  background-color: #f5f7fa !important;\r\n  color: #606266 !important;\r\n  padding: 8px !important;\r\n}\r\n.db-table-columns-info .el-table__cell {\r\n  padding: 8px !important;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}