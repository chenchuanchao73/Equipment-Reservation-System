{"ast":null,"code":"import axios from 'axios';\nimport { mapState } from 'vuex';\nimport DatabaseViewer from './DatabaseViewer.vue';\nexport default {\n  name: 'AdminSettings',\n  components: {\n    DatabaseViewer\n  },\n  data() {\n    return {\n      activeTab: 'base',\n      emailSettings: {\n        smtp_server: '',\n        smtp_port: 587,\n        sender_email: '',\n        sender_name: '',\n        smtp_username: '',\n        smtp_password: '',\n        cc_list: '',\n        bcc_list: '',\n        use_ssl: true,\n        enabled: false\n      },\n      templateList: [],\n      templateDialogVisible: false,\n      templateDialogTitle: '新增模板',\n      templateForm: {\n        id: null,\n        name: '',\n        template_key: '',\n        subject: '',\n        content_html: '',\n        language: 'zh_CN'\n      },\n      templateRules: {\n        name: [{\n          required: true,\n          message: '请输入模板名称',\n          trigger: 'blur'\n        }],\n        template_key: [{\n          required: true,\n          message: '请输入模板键名',\n          trigger: 'blur'\n        }],\n        subject: [{\n          required: true,\n          message: '请输入主题',\n          trigger: 'blur'\n        }],\n        content_html: [{\n          required: true,\n          message: '请输入HTML内容',\n          trigger: 'blur'\n        }],\n        language: [{\n          required: true,\n          message: '请选择语言',\n          trigger: 'change'\n        }]\n      },\n      logList: [],\n      logTotal: 0,\n      logPage: 1,\n      logPageSize: 10,\n      logFilter: {\n        status: '',\n        event_type: ''\n      },\n      testEmail: '',\n      testLoading: false,\n      editRow: null,\n      editCache: {},\n      logContentDialogVisible: false,\n      selectedLog: null\n    };\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user\n    }),\n    isSuperAdmin() {\n      return this.user && this.user.role === 'superadmin';\n    }\n  },\n  created() {\n    this.fetchEmailSettings();\n    this.fetchTemplates();\n    this.fetchLogs();\n  },\n  methods: {\n    handleTabClick(tab) {\n      if (tab.name === 'db-viewer' && this.$refs.dbViewer) {\n        this.$refs.dbViewer.initIfNeeded();\n      }\n    },\n    async fetchEmailSettings() {\n      try {\n        const res = await axios.get('/api/admin/email/settings');\n        this.emailSettings = res.data;\n      } catch (e) {\n        this.$message.error('获取邮件设置失败');\n      }\n    },\n    async saveEmailSettings() {\n      try {\n        await axios.post('/api/admin/email/settings', this.emailSettings);\n        this.$message.success('保存成功');\n      } catch (e) {\n        this.$message.error('保存失败');\n      }\n    },\n    async fetchTemplates() {\n      try {\n        const res = await axios.get('/api/admin/email/templates');\n        this.templateList = res.data;\n      } catch (e) {\n        this.$message.error('获取模板失败');\n      }\n    },\n    openTemplateDialog(row) {\n      if (row) {\n        this.templateDialogTitle = '编辑模板';\n        this.templateForm = {\n          ...row\n        };\n      } else {\n        this.templateDialogTitle = '新增模板';\n        this.templateForm = {\n          id: null,\n          name: '',\n          template_key: '',\n          subject: '',\n          content_html: '',\n          language: 'zh_CN'\n        };\n      }\n      this.templateDialogVisible = true;\n    },\n    async saveTemplate() {\n      this.$refs.templateFormRef.validate(async valid => {\n        if (!valid) return;\n        try {\n          if (this.templateForm.id) {\n            await axios.put(`/api/admin/email/templates/${this.templateForm.id}`, this.templateForm);\n            this.$message.success('更新成功');\n          } else {\n            await axios.post('/api/admin/email/templates', this.templateForm);\n            this.$message.success('新增成功');\n          }\n          this.templateDialogVisible = false;\n          this.fetchTemplates();\n        } catch (e) {\n          this.$message.error(e.response?.data?.detail || '保存失败');\n        }\n      });\n    },\n    async deleteTemplate(row) {\n      this.$confirm('确定要删除该模板吗？', '提示', {\n        type: 'warning'\n      }).then(async () => {\n        await axios.delete(`/api/admin/email/templates/${row.id}`);\n        this.$message.success('删除成功');\n        this.fetchTemplates();\n      }).catch(() => {});\n    },\n    async fetchLogs() {\n      try {\n        const params = {\n          skip: (this.logPage - 1) * this.logPageSize,\n          limit: this.logPageSize,\n          status: this.logFilter.status,\n          event_type: this.logFilter.event_type\n        };\n        const res = await axios.get('/api/admin/email/logs', {\n          params\n        });\n        this.logList = res.data.items;\n        this.logTotal = res.data.total;\n      } catch (e) {\n        this.$message.error('获取日志失败');\n      }\n    },\n    clearLogFilter() {\n      this.logFilter = {\n        status: '',\n        event_type: ''\n      };\n      this.logPage = 1;\n      this.fetchLogs();\n    },\n    async deleteLog(row) {\n      this.$confirm('确定要删除该日志吗？', '提示', {\n        type: 'warning'\n      }).then(async () => {\n        await axios.delete(`/api/admin/email/logs/${row.id}`);\n        this.$message.success('删除成功');\n        this.fetchLogs();\n      }).catch(() => {});\n    },\n    formatDate(val) {\n      if (!val) return '';\n      let d = typeof val === 'string' && !val.endsWith('Z') ? new Date(val + 'Z') : new Date(val);\n      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;\n    },\n    async testEmailSend() {\n      if (!this.testEmail) {\n        this.$message.warning('请输入测试收件人邮箱');\n        return;\n      }\n      this.testLoading = true;\n      try {\n        const payload = {\n          ...this.emailSettings,\n          to_email: this.testEmail\n        };\n        const res = await axios.post('/api/admin/email/test', payload);\n        if (res.data.success) {\n          this.$message.success(res.data.message);\n        } else {\n          this.$message.error(res.data.message);\n        }\n      } catch (e) {\n        this.$message.error('请求失败');\n      } finally {\n        this.testLoading = false;\n      }\n    },\n    startEdit(row) {\n      this.editRow = row.id;\n      this.editCache = {\n        ...row\n      };\n    },\n    cancelEdit() {\n      this.editRow = null;\n      this.editCache = {};\n    },\n    async saveEdit(row) {\n      try {\n        await this.$confirm('确定保存修改吗？', '提示', {\n          type: 'warning'\n        });\n        await axios.put(`/api/admin/email/templates/${row.id}`, this.editCache);\n        this.$message.success('保存成功');\n        this.editRow = null;\n        this.editCache = {};\n        this.fetchTemplates();\n      } catch (e) {\n        this.$message.error(e.response?.data?.detail || '保存失败');\n      }\n    },\n    showLogContent(log) {\n      this.selectedLog = log;\n      window.selectedLog = log;\n      this.logContentDialogVisible = true;\n    }\n  }\n};","map":{"version":3,"names":["axios","mapState","DatabaseViewer","name","components","data","activeTab","emailSettings","smtp_server","smtp_port","sender_email","sender_name","smtp_username","smtp_password","cc_list","bcc_list","use_ssl","enabled","templateList","templateDialogVisible","templateDialogTitle","templateForm","id","template_key","subject","content_html","language","templateRules","required","message","trigger","logList","logTotal","logPage","logPageSize","logFilter","status","event_type","testEmail","testLoading","editRow","editCache","logContentDialogVisible","selectedLog","computed","user","state","isSuperAdmin","role","created","fetchEmailSettings","fetchTemplates","fetchLogs","methods","handleTabClick","tab","$refs","dbViewer","initIfNeeded","res","get","e","$message","error","saveEmailSettings","post","success","openTemplateDialog","row","saveTemplate","templateFormRef","validate","valid","put","response","detail","deleteTemplate","$confirm","type","then","delete","catch","params","skip","limit","items","total","clearLogFilter","deleteLog","formatDate","val","d","endsWith","Date","getFullYear","String","getMonth","padStart","getDate","getHours","getMinutes","testEmailSend","warning","payload","to_email","startEdit","cancelEdit","saveEdit","showLogContent","log","window"],"sources":["src/views/admin/AdminSettings.vue"],"sourcesContent":["<template>\n  <div class=\"admin-settings\">\n    <el-tabs v-model=\"activeTab\" @tab-click=\"handleTabClick\">\n      <el-tab-pane label=\"基础设置\" name=\"base\">\n        <p>（这里是原有系统设置内容）</p>\n      </el-tab-pane>\n      <el-tab-pane label=\"邮件设置\" name=\"email\">\n        <el-form :model=\"emailSettings\" label-width=\"120px\" @submit.native.prevent=\"saveEmailSettings\">\n          <el-form-item label=\"SMTP服务器\">\n            <el-input v-model=\"emailSettings.smtp_server\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"端口\">\n            <el-input v-model=\"emailSettings.smtp_port\" type=\"number\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"发件人邮箱\">\n            <el-input v-model=\"emailSettings.sender_email\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"发件人名称\">\n            <el-input v-model=\"emailSettings.sender_name\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"SMTP用户名\">\n            <el-input v-model=\"emailSettings.smtp_username\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"SMTP密码\">\n            <el-input v-model=\"emailSettings.smtp_password\" show-password></el-input>\n          </el-form-item>\n          <el-form-item label=\"抄送人列表\">\n            <el-input\n              v-model=\"emailSettings.cc_list\"\n              type=\"textarea\"\n              :rows=\"2\"\n              placeholder=\"多个邮箱请用逗号分隔，例如：admin1@example.com, admin2@example.com\"\n            ></el-input>\n            <div class=\"form-tip\">多个邮箱请用逗号分隔，所有发出的邮件都会抄送给这些邮箱</div>\n          </el-form-item>\n          <el-form-item label=\"密送人列表\">\n            <el-input\n              v-model=\"emailSettings.bcc_list\"\n              type=\"textarea\"\n              :rows=\"2\"\n              placeholder=\"多个邮箱请用逗号分隔，例如：manager1@example.com, manager2@example.com\"\n            ></el-input>\n            <div class=\"form-tip\">多个邮箱请用逗号分隔，所有发出的邮件都会密送给这些邮箱</div>\n          </el-form-item>\n          <el-form-item label=\"使用SSL\">\n            <el-switch v-model=\"emailSettings.use_ssl\"></el-switch>\n          </el-form-item>\n          <el-form-item label=\"启用邮件功能\">\n            <el-switch v-model=\"emailSettings.enabled\"></el-switch>\n          </el-form-item>\n          <el-form-item label=\"测试收件人邮箱\">\n            <el-input v-model=\"testEmail\"></el-input>\n            <el-button type=\"primary\" @click=\"testEmailSend\" :loading=\"testLoading\" style=\"margin-left:10px;\">测试邮件</el-button>\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" @click=\"saveEmailSettings\">保存</el-button>\n          </el-form-item>\n        </el-form>\n      </el-tab-pane>\n      <el-tab-pane label=\"邮件模板\" name=\"template\">\n        <div style=\"margin-bottom: 10px;\">\n          <el-button type=\"primary\" @click=\"openTemplateDialog()\">新增模板</el-button>\n        </div>\n        <el-table :data=\"templateList\" border style=\"width: 100%\">\n          <el-table-column prop=\"name\" label=\"模板名称\" min-width=\"120\">\n            <template slot-scope=\"scope\">\n              <span v-if=\"editRow !== scope.row.id\">{{ scope.row.name }}</span>\n              <el-input v-else v-model=\"editCache.name\" size=\"small\"></el-input>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"template_key\" label=\"模板键名\" min-width=\"120\"/>\n          <el-table-column prop=\"subject\" label=\"主题\" min-width=\"150\">\n            <template slot-scope=\"scope\">\n              <span v-if=\"editRow !== scope.row.id\">{{ scope.row.subject }}</span>\n              <el-input v-else v-model=\"editCache.subject\" size=\"small\"></el-input>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"language\" label=\"语言\" min-width=\"80\">\n            <template slot-scope=\"scope\">\n              <span v-if=\"editRow !== scope.row.id\">{{ scope.row.language }}</span>\n              <el-select v-else v-model=\"editCache.language\" size=\"small\" style=\"width:100px\">\n                <el-option label=\"中文\" value=\"zh_CN\"/>\n                <el-option label=\"English\" value=\"en\"/>\n              </el-select>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"content_html\" label=\"HTML内容\" min-width=\"250\">\n            <template slot-scope=\"scope\">\n              <span v-if=\"editRow !== scope.row.id\" style=\"white-space:pre-line;word-break:break-all;max-width:400px;display:inline-block;\">\n                {{ scope.row.content_html }}\n              </span>\n              <el-input\n                v-else\n                type=\"textarea\"\n                v-model=\"editCache.content_html\"\n                :rows=\"4\"\n                size=\"small\"\n              ></el-input>\n            </template>\n          </el-table-column>\n          <el-table-column label=\"操作\" min-width=\"150\">\n            <template slot-scope=\"scope\">\n              <template v-if=\"editRow === scope.row.id\">\n                <el-button type=\"primary\" size=\"mini\" @click=\"saveEdit(scope.row)\">保存</el-button>\n                <el-button size=\"mini\" @click=\"cancelEdit\">取消</el-button>\n              </template>\n              <template v-else>\n                <el-button type=\"text\" @click=\"startEdit(scope.row)\">编辑</el-button>\n                <el-button type=\"text\" style=\"color:red\" @click=\"deleteTemplate(scope.row)\">删除</el-button>\n              </template>\n            </template>\n          </el-table-column>\n        </el-table>\n        <el-dialog :title=\"templateDialogTitle\" :visible.sync=\"templateDialogVisible\" width=\"600px\">\n          <el-form :model=\"templateForm\" label-width=\"100px\" :rules=\"templateRules\" ref=\"templateFormRef\">\n            <el-form-item label=\"模板名称\" prop=\"name\">\n              <el-input v-model=\"templateForm.name\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"模板键名\" prop=\"template_key\">\n              <el-input v-model=\"templateForm.template_key\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"主题\" prop=\"subject\">\n              <el-input v-model=\"templateForm.subject\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"语言\" prop=\"language\">\n              <el-select v-model=\"templateForm.language\" placeholder=\"请选择\">\n                <el-option label=\"中文\" value=\"zh_CN\"/>\n                <el-option label=\"English\" value=\"en\"/>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"HTML内容\" prop=\"content_html\">\n              <el-input type=\"textarea\" v-model=\"templateForm.content_html\" :rows=\"8\" placeholder=\"支持Jinja2变量，如 reservation.user_name\"></el-input>\n            </el-form-item>\n          </el-form>\n          <div slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"templateDialogVisible = false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"saveTemplate\">保存</el-button>\n          </div>\n        </el-dialog>\n      </el-tab-pane>\n      <el-tab-pane label=\"邮件日志\" name=\"log\">\n        <el-form :inline=\"true\" size=\"small\" style=\"margin-bottom:10px;\">\n          <el-form-item label=\"状态\">\n            <el-select v-model=\"logFilter.status\" clearable placeholder=\"全部\">\n              <el-option label=\"成功\" value=\"success\"/>\n              <el-option label=\"失败\" value=\"failed\"/>\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"事件类型\">\n            <el-input v-model=\"logFilter.event_type\" placeholder=\"如 reservation_created\" clearable></el-input>\n          </el-form-item>\n          <el-form-item>\n            <el-button @click=\"fetchLogs\" type=\"primary\">查询</el-button>\n            <el-button @click=\"clearLogFilter\">重置</el-button>\n          </el-form-item>\n        </el-form>\n        <el-table :data=\"logList\" border style=\"width: 100%\">\n          <el-table-column prop=\"recipient\" label=\"收件人\" min-width=\"120\"/>\n          <el-table-column prop=\"subject\" label=\"主题\" min-width=\"150\"/>\n          <el-table-column prop=\"event_type\" label=\"事件类型\" min-width=\"120\"/>\n          <el-table-column prop=\"status\" label=\"状态\" min-width=\"80\">\n            <template slot-scope=\"scope\">\n              <el-tag :type=\"scope.row.status === 'success' ? 'success' : 'danger'\">\n                {{ scope.row.status === 'success' ? '成功' : '失败' }}\n              </el-tag>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"created_at\" label=\"时间\" min-width=\"160\">\n            <template slot-scope=\"scope\">\n              {{ formatDate(scope.row.created_at) }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"操作\" width=\"120\">\n            <template slot-scope=\"scope\">\n              <el-button size=\"mini\" @click=\"showLogContent(scope.row)\">查看内容</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n        <el-pagination\n          style=\"margin-top:10px;text-align:right\"\n          background\n          layout=\"prev, pager, next, jumper\"\n          :total=\"logTotal\"\n          :page-size=\"logPageSize\"\n          :current-page.sync=\"logPage\"\n          @current-change=\"fetchLogs\"\n        />\n        <el-dialog\n          title=\"邮件内容\"\n          :visible.sync=\"logContentDialogVisible\"\n          width=\"60%\">\n          <div v-if=\"selectedLog && selectedLog.content_html\" v-html=\"selectedLog.content_html\"></div>\n          <div v-else>暂无内容</div>\n        </el-dialog>\n      </el-tab-pane>\n      <el-tab-pane v-if=\"isSuperAdmin\" label=\"数据库表查看\" name=\"db-viewer\">\n        <DatabaseViewer ref=\"dbViewer\" />\n      </el-tab-pane>\n    </el-tabs>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport { mapState } from 'vuex'\nimport DatabaseViewer from './DatabaseViewer.vue'\nexport default {\n  name: 'AdminSettings',\n  components: { DatabaseViewer },\n  data() {\n    return {\n      activeTab: 'base',\n      emailSettings: {\n        smtp_server: '',\n        smtp_port: 587,\n        sender_email: '',\n        sender_name: '',\n        smtp_username: '',\n        smtp_password: '',\n        cc_list: '',\n        bcc_list: '',\n        use_ssl: true,\n        enabled: false\n      },\n      templateList: [],\n      templateDialogVisible: false,\n      templateDialogTitle: '新增模板',\n      templateForm: {\n        id: null,\n        name: '',\n        template_key: '',\n        subject: '',\n        content_html: '',\n        language: 'zh_CN'\n      },\n      templateRules: {\n        name: [{ required: true, message: '请输入模板名称', trigger: 'blur' }],\n        template_key: [{ required: true, message: '请输入模板键名', trigger: 'blur' }],\n        subject: [{ required: true, message: '请输入主题', trigger: 'blur' }],\n        content_html: [{ required: true, message: '请输入HTML内容', trigger: 'blur' }],\n        language: [{ required: true, message: '请选择语言', trigger: 'change' }]\n      },\n      logList: [],\n      logTotal: 0,\n      logPage: 1,\n      logPageSize: 10,\n      logFilter: {\n        status: '',\n        event_type: ''\n      },\n      testEmail: '',\n      testLoading: false,\n      editRow: null,\n      editCache: {},\n      logContentDialogVisible: false,\n      selectedLog: null\n    }\n  },\n  computed: {\n    ...mapState({\n      user: state => state.user,\n    }),\n    isSuperAdmin() {\n      return this.user && this.user.role === 'superadmin'\n    },\n  },\n  created() {\n    this.fetchEmailSettings()\n    this.fetchTemplates()\n    this.fetchLogs()\n  },\n  methods: {\n    handleTabClick(tab) {\n      if (tab.name === 'db-viewer' && this.$refs.dbViewer) {\n        this.$refs.dbViewer.initIfNeeded()\n      }\n    },\n    async fetchEmailSettings() {\n      try {\n        const res = await axios.get('/api/admin/email/settings')\n        this.emailSettings = res.data\n      } catch (e) {\n        this.$message.error('获取邮件设置失败')\n      }\n    },\n    async saveEmailSettings() {\n      try {\n        await axios.post('/api/admin/email/settings', this.emailSettings)\n        this.$message.success('保存成功')\n      } catch (e) {\n        this.$message.error('保存失败')\n      }\n    },\n    async fetchTemplates() {\n      try {\n        const res = await axios.get('/api/admin/email/templates')\n        this.templateList = res.data\n      } catch (e) {\n        this.$message.error('获取模板失败')\n      }\n    },\n    openTemplateDialog(row) {\n      if (row) {\n        this.templateDialogTitle = '编辑模板'\n        this.templateForm = { ...row }\n      } else {\n        this.templateDialogTitle = '新增模板'\n        this.templateForm = {\n          id: null,\n          name: '',\n          template_key: '',\n          subject: '',\n          content_html: '',\n          language: 'zh_CN'\n        }\n      }\n      this.templateDialogVisible = true\n    },\n    async saveTemplate() {\n      this.$refs.templateFormRef.validate(async valid => {\n        if (!valid) return\n        try {\n          if (this.templateForm.id) {\n            await axios.put(`/api/admin/email/templates/${this.templateForm.id}`, this.templateForm)\n            this.$message.success('更新成功')\n          } else {\n            await axios.post('/api/admin/email/templates', this.templateForm)\n            this.$message.success('新增成功')\n          }\n          this.templateDialogVisible = false\n          this.fetchTemplates()\n        } catch (e) {\n          this.$message.error(e.response?.data?.detail || '保存失败')\n        }\n      })\n    },\n    async deleteTemplate(row) {\n      this.$confirm('确定要删除该模板吗？', '提示', { type: 'warning' })\n        .then(async () => {\n          await axios.delete(`/api/admin/email/templates/${row.id}`)\n          this.$message.success('删除成功')\n          this.fetchTemplates()\n        })\n        .catch(() => {})\n    },\n    async fetchLogs() {\n      try {\n        const params = {\n          skip: (this.logPage - 1) * this.logPageSize,\n          limit: this.logPageSize,\n          status: this.logFilter.status,\n          event_type: this.logFilter.event_type\n        }\n        const res = await axios.get('/api/admin/email/logs', { params })\n        this.logList = res.data.items\n        this.logTotal = res.data.total\n      } catch (e) {\n        this.$message.error('获取日志失败')\n      }\n    },\n    clearLogFilter() {\n      this.logFilter = { status: '', event_type: '' }\n      this.logPage = 1\n      this.fetchLogs()\n    },\n    async deleteLog(row) {\n      this.$confirm('确定要删除该日志吗？', '提示', { type: 'warning' })\n        .then(async () => {\n          await axios.delete(`/api/admin/email/logs/${row.id}`)\n          this.$message.success('删除成功')\n          this.fetchLogs()\n        })\n        .catch(() => {})\n    },\n    formatDate(val) {\n      if (!val) return ''\n      let d = typeof val === 'string' && !val.endsWith('Z')\n        ? new Date(val + 'Z')\n        : new Date(val)\n      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`\n    },\n    async testEmailSend() {\n      if (!this.testEmail) {\n        this.$message.warning('请输入测试收件人邮箱')\n        return\n      }\n      this.testLoading = true\n      try {\n        const payload = {\n          ...this.emailSettings,\n          to_email: this.testEmail\n        }\n        const res = await axios.post('/api/admin/email/test', payload)\n        if (res.data.success) {\n          this.$message.success(res.data.message)\n        } else {\n          this.$message.error(res.data.message)\n        }\n      } catch (e) {\n        this.$message.error('请求失败')\n      } finally {\n        this.testLoading = false\n      }\n    },\n    startEdit(row) {\n      this.editRow = row.id\n      this.editCache = { ...row }\n    },\n    cancelEdit() {\n      this.editRow = null\n      this.editCache = {}\n    },\n    async saveEdit(row) {\n      try {\n        await this.$confirm('确定保存修改吗？', '提示', { type: 'warning' })\n        await axios.put(`/api/admin/email/templates/${row.id}`, this.editCache)\n        this.$message.success('保存成功')\n        this.editRow = null\n        this.editCache = {}\n        this.fetchTemplates()\n      } catch (e) {\n        this.$message.error(e.response?.data?.detail || '保存失败')\n      }\n    },\n    showLogContent(log) {\n      this.selectedLog = log;\n      window.selectedLog = log;\n      this.logContentDialogVisible = true;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.admin-settings {\n  padding: 20px;\n}\n\n.form-tip {\n  font-size: 12px;\n  color: #909399;\n  line-height: 1.2;\n  padding-top: 4px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}