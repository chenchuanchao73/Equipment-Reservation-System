{"ast":null,"code":"import Vue from 'vue';\nimport App from './App.vue';\nimport router from './router';\nimport store from './store';\nimport ElementUI from 'element-ui';\nimport 'element-ui/lib/theme-chalk/index.css';\n// 引入暗色主题CSS\nimport '@/assets/css/dark-theme.css';\nimport VueI18n from 'vue-i18n';\nimport axios from 'axios';\nimport enLocale from 'element-ui/lib/locale/lang/en';\nimport zhLocale from 'element-ui/lib/locale/lang/zh-CN';\nimport Router from 'vue-router';\n\n// Import API\nimport * as api from './api';\n\n// 导入权限控制\nimport './router/permission';\n\n// 导入富文本编辑器\n// 暂时注释掉富文本编辑器相关代码\n// import VueQuillEditor from 'vue-quill-editor'\n// import 'quill/dist/quill.core.css'\n// import 'quill/dist/quill.snow.css'\n// import 'quill/dist/quill.bubble.css'\n\n// 导入语言包\nimport zhCN from './locales/zh-CN';\nimport en from './locales/en';\n\n// 使用插件\nVue.use(VueI18n);\n// Vue.use(VueQuillEditor) // 暂时注释掉\n\n// === 在应用初始化时同步 token 和 user 到 Vuex ===\nconst token = localStorage.getItem('token');\nif (token) store.commit('SET_TOKEN', token);\nconst user = localStorage.getItem('user');\nif (user) store.commit('SET_USER', JSON.parse(user));\n\n// 初始化主题设置\nconst darkMode = localStorage.getItem('darkMode') === 'true';\nif (darkMode) {\n  document.documentElement.classList.add('dark-mode');\n}\n\n// 配置axios\n// 动态获取API基础URL\nconst getApiBaseUrl = () => {\n  // 如果是开发环境，使用当前主机名但端口改为8000\n  const currentHost = window.location.hostname;\n  const apiUrl = `http://${currentHost}:8000`;\n\n  // 添加额外的调试信息\n  console.log('Current hostname:', currentHost);\n  console.log('Generated API URL:', apiUrl);\n  return apiUrl;\n};\n\n// 设置axios基础URL\naxios.defaults.baseURL = getApiBaseUrl();\n// 增加超时时间到 30 秒\naxios.defaults.timeout = 30000;\n// 添加调试日志\nconsole.log('API Base URL:', axios.defaults.baseURL);\naxios.interceptors.request.use(config => {\n  // 从localStorage获取token\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\naxios.interceptors.response.use(response => {\n  return response;\n}, error => {\n  // 检查是否是401错误\n  if (error.response && error.response.status === 401) {\n    // 检查当前路由是否已经是登录页或非管理员页面\n    const isAdminRoute = router.currentRoute.path.startsWith('/admin') && router.currentRoute.path !== '/admin/login';\n\n    // 只有在管理员页面才显示提示和重定向\n    if (isAdminRoute) {\n      // 显示友好的提示信息\n      Vue.prototype.$message({\n        message: '您的会话已过期，请重新登录',\n        type: 'warning',\n        duration: 3000\n      });\n      store.dispatch('logout');\n      router.push('/admin/login');\n    }\n\n    // 对于仪表盘和统计API的401错误，不在控制台显示错误\n    if (error.config && (error.config.url.includes('/api/statistics') || error.config.url.includes('/dashboard'))) {\n      // 静默处理这些API的401错误\n      console.log('未登录状态下访问受保护的API，已静默处理');\n      return Promise.reject({\n        ...error,\n        _silenced: true // 添加标记，表示此错误已被静默处理\n      });\n    }\n  } else if (error.response) {\n    // 对于非401错误，记录详细信息\n    console.error('AXIOS ERROR:', error);\n    console.error('AXIOS ERROR RESPONSE:', error.response);\n    console.error('AXIOS ERROR URL:', error.config && error.config.url);\n  }\n  return Promise.reject(error);\n});\nVue.prototype.$http = axios;\n\n// 配置i18n\nconst i18n = new VueI18n({\n  locale: store.state.language || 'zh-CN',\n  messages: {\n    'zh-CN': {\n      ...zhCN,\n      el: zhLocale.el\n    },\n    'en': {\n      ...en,\n      el: enLocale.el\n    }\n  },\n  silentTranslationWarn: true\n});\n\n// 同步语言设置\nstore.watch(state => state.language, newLang => {\n  i18n.locale = newLang;\n  document.querySelector('html').setAttribute('lang', newLang);\n  console.log('Language changed to:', newLang);\n});\n\n// 使用Element UI\nVue.use(ElementUI, {\n  i18n: (key, value) => i18n.t(key, value)\n});\n\n// 导入日期工具函数\nimport { formatDate, convertToBeijingTime } from './utils/date';\n\n// 全局过滤器\nVue.filter('dateFormat', function (value, format = 'YYYY-MM-DD HH:mm') {\n  if (!value) return '';\n\n  // 使用日期工具函数，自动转换为北京时间\n  return formatDate(value, format, true);\n});\nVue.config.productionTip = false;\nconst originalPush = Router.prototype.push;\nRouter.prototype.push = function push(location, onResolve, onReject) {\n  if (onResolve || onReject) return originalPush.call(this, location, onResolve, onReject);\n  return originalPush.call(this, location).catch(err => {\n    if (err.name === 'NavigationDuplicated' || err.message.includes('Redirected when going')) {\n      // 忽略重复导航和重定向警告\n      return;\n    }\n    throw err;\n  });\n};\n\n// 全局注册API对象\nVue.prototype.$api = api.api;\nnew Vue({\n  router,\n  store,\n  i18n,\n  render: h => h(App)\n}).$mount('#app');","map":{"version":3,"names":["Vue","App","router","store","ElementUI","VueI18n","axios","enLocale","zhLocale","Router","api","zhCN","en","use","token","localStorage","getItem","commit","user","JSON","parse","darkMode","document","documentElement","classList","add","getApiBaseUrl","currentHost","window","location","hostname","apiUrl","console","log","defaults","baseURL","timeout","interceptors","request","config","headers","Authorization","error","Promise","reject","response","status","isAdminRoute","currentRoute","path","startsWith","prototype","$message","message","type","duration","dispatch","push","url","includes","_silenced","$http","i18n","locale","state","language","messages","el","silentTranslationWarn","watch","newLang","querySelector","setAttribute","key","value","t","formatDate","convertToBeijingTime","filter","format","productionTip","originalPush","onResolve","onReject","call","catch","err","name","$api","render","h","$mount"],"sources":["D:/Equipment-Reservation-System-main/frontend/src/main.js"],"sourcesContent":["import Vue from 'vue'\nimport App from './App.vue'\nimport router from './router'\nimport store from './store'\nimport ElementUI from 'element-ui'\nimport 'element-ui/lib/theme-chalk/index.css'\n// 引入暗色主题CSS\nimport '@/assets/css/dark-theme.css'\nimport VueI18n from 'vue-i18n'\nimport axios from 'axios'\nimport enLocale from 'element-ui/lib/locale/lang/en'\nimport zhLocale from 'element-ui/lib/locale/lang/zh-CN'\nimport Router from 'vue-router'\n\n// Import API\nimport * as api from './api'\n\n// 导入权限控制\nimport './router/permission'\n\n// 导入富文本编辑器\n// 暂时注释掉富文本编辑器相关代码\n// import VueQuillEditor from 'vue-quill-editor'\n// import 'quill/dist/quill.core.css'\n// import 'quill/dist/quill.snow.css'\n// import 'quill/dist/quill.bubble.css'\n\n// 导入语言包\nimport zhCN from './locales/zh-CN'\nimport en from './locales/en'\n\n// 使用插件\nVue.use(VueI18n)\n// Vue.use(VueQuillEditor) // 暂时注释掉\n\n// === 在应用初始化时同步 token 和 user 到 Vuex ===\nconst token = localStorage.getItem('token')\nif (token) store.commit('SET_TOKEN', token)\nconst user = localStorage.getItem('user')\nif (user) store.commit('SET_USER', JSON.parse(user))\n\n// 初始化主题设置\nconst darkMode = localStorage.getItem('darkMode') === 'true'\nif (darkMode) {\n  document.documentElement.classList.add('dark-mode')\n}\n\n// 配置axios\n// 动态获取API基础URL\nconst getApiBaseUrl = () => {\n  // 如果是开发环境，使用当前主机名但端口改为8000\n  const currentHost = window.location.hostname\n  const apiUrl = `http://${currentHost}:8000`\n\n  // 添加额外的调试信息\n  console.log('Current hostname:', currentHost)\n  console.log('Generated API URL:', apiUrl)\n\n  return apiUrl\n}\n\n// 设置axios基础URL\naxios.defaults.baseURL = getApiBaseUrl()\n// 增加超时时间到 30 秒\naxios.defaults.timeout = 30000\n// 添加调试日志\nconsole.log('API Base URL:', axios.defaults.baseURL)\naxios.interceptors.request.use(config => {\n  // 从localStorage获取token\n  const token = localStorage.getItem('token')\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`\n  }\n  return config\n}, error => {\n  return Promise.reject(error)\n})\n\naxios.interceptors.response.use(response => {\n  return response\n}, error => {\n  // 检查是否是401错误\n  if (error.response && error.response.status === 401) {\n    // 检查当前路由是否已经是登录页或非管理员页面\n    const isAdminRoute = router.currentRoute.path.startsWith('/admin') &&\n                         router.currentRoute.path !== '/admin/login'\n\n    // 只有在管理员页面才显示提示和重定向\n    if (isAdminRoute) {\n      // 显示友好的提示信息\n      Vue.prototype.$message({\n        message: '您的会话已过期，请重新登录',\n        type: 'warning',\n        duration: 3000\n      })\n\n      store.dispatch('logout')\n      router.push('/admin/login')\n    }\n\n    // 对于仪表盘和统计API的401错误，不在控制台显示错误\n    if (error.config && (\n        error.config.url.includes('/api/statistics') ||\n        error.config.url.includes('/dashboard')\n      )) {\n      // 静默处理这些API的401错误\n      console.log('未登录状态下访问受保护的API，已静默处理')\n      return Promise.reject({\n        ...error,\n        _silenced: true // 添加标记，表示此错误已被静默处理\n      })\n    }\n  } else if (error.response) {\n    // 对于非401错误，记录详细信息\n    console.error('AXIOS ERROR:', error)\n    console.error('AXIOS ERROR RESPONSE:', error.response)\n    console.error('AXIOS ERROR URL:', error.config && error.config.url)\n  }\n\n  return Promise.reject(error)\n})\n\nVue.prototype.$http = axios\n\n// 配置i18n\nconst i18n = new VueI18n({\n  locale: store.state.language || 'zh-CN',\n  messages: {\n    'zh-CN': {\n      ...zhCN,\n      el: zhLocale.el\n    },\n    'en': {\n      ...en,\n      el: enLocale.el\n    }\n  },\n  silentTranslationWarn: true\n})\n\n// 同步语言设置\nstore.watch(\n  state => state.language,\n  (newLang) => {\n    i18n.locale = newLang\n    document.querySelector('html').setAttribute('lang', newLang)\n    console.log('Language changed to:', newLang)\n  }\n)\n\n// 使用Element UI\nVue.use(ElementUI, {\n  i18n: (key, value) => i18n.t(key, value)\n})\n\n// 导入日期工具函数\nimport { formatDate, convertToBeijingTime } from './utils/date'\n\n// 全局过滤器\nVue.filter('dateFormat', function(value, format = 'YYYY-MM-DD HH:mm') {\n  if (!value) return ''\n\n  // 使用日期工具函数，自动转换为北京时间\n  return formatDate(value, format, true)\n})\n\nVue.config.productionTip = false\n\nconst originalPush = Router.prototype.push\nRouter.prototype.push = function push(location, onResolve, onReject) {\n  if (onResolve || onReject) return originalPush.call(this, location, onResolve, onReject)\n  return originalPush.call(this, location).catch(err => {\n    if (\n      err.name === 'NavigationDuplicated' ||\n      err.message.includes('Redirected when going')\n    ) {\n      // 忽略重复导航和重定向警告\n      return\n    }\n    throw err\n  })\n}\n\n// 全局注册API对象\nVue.prototype.$api = api.api\n\nnew Vue({\n  router,\n  store,\n  i18n,\n  render: h => h(App)\n}).$mount('#app')\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}